{"version":3,"sources":["utalk.js"],"names":["messageHandle","data","wsHandle","filterData","input","from","to","message","hasOwnProperty","command","m","trim","length","sendMessage","showMessage","Box","isRemote","clearInput","searchBaiduImage","imgArray","domSet","formatImageSet","sendLocalSearch","_data","console","log","showSearchResult","innerHTML","socket","close","window","formatTime","date","str","getHours","getMinutes","getSeconds","set","document","getElementById","shadow","shiftDown","localStorage","getItem","cached_nickname","value","nick","focus","e","preventDefault","addEventListener","io","on","utalk","code","emit","placeholder","setItem","style","opacity","getClients","listen","Date","time","color","keyCode","scrollTop","scrollHeight"],"mappings":"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","file":"utalk.min.js","sourcesContent":["(function () {\n\n    var set = document.getElementById('set');\n    var Box = document.getElementById('message_box');\n    var input = document.getElementById('input');\n    var shadow = document.getElementById('shadow');\n    var isRemote = true;\n    var shiftDown = false;\n    var wsHandle = {};\n    var socket = {};\n\n    /**\n     * @param {string} cached_nickname use cached_nickname if is in localstorage. Otherwise use an input nickname\n     */\n    var cached_nickname = localStorage.getItem('nick');\n    if (cached_nickname) {\n        var nick = localStorage.getItem('nick');\n        document.getElementById('nick').value = nick;\n        document.getElementById('nick').focus();\n    }\n    shadow.addEventListener('click', function () {\n        set.nick.focus();\n    })\n    set.addEventListener('submit', function (e) {\n        e.preventDefault();\n        var nick = set.nick.value.trim();\n        if (nick.length >= 5) {\n\n            // setTimeout(function () {\n            //     shadow.style.display = 'none';\n\n            socket = io('http://106.15.91.176:7878/');\n\n            // socket默认事件 连接成功\n            socket.on('connect', function () {\n\n                wsHandle = new utalk.wsHandle(socket, nick); // wsHandle can use this socket\n\n                socket.emit('regist', nick, function (data) {\n                    switch (data.code) {\n                        case 0: {\n                            // 用户名存在\n                            set.nick.placeholder = data.m;\n                            set.nick.value = '';\n                            set.nick.focus();\n                        } break;\n                        case 1: {\n                            // 注册成功\n                            localStorage.setItem('nick', nick);\n                            shadow.style.opacity = 0;\n                            input.from.value = nick;\n                            input.message.focus();\n\n                            setTimeout(function () {\n                                shadow.style.display = 'none';\n                            }, 505);\n\n                        } break;\n                        default: {\n\n                        } break;\n                    }\n\n                })\n\n                wsHandle.getClients(input.to);\n\n                wsHandle.listen('message', function (data) {\n                    wsHandle.showMessage(Box, data, isRemote);\n                })\n\n                wsHandle.listen('new_user', function () {\n                    wsHandle.getClients(input.to);\n                })\n\n                wsHandle.listen('user_not_in', function (data) {\n                    wsHandle.showMessage(Box, data, isRemote);\n                })\n\n                wsHandle.showMessage(Box, {\n                    from: 'Utalk',\n                    to: 'nick',\n                    time: formatTime(new Date(), '-'),\n                    m: '欢迎使用Utalk，本软件属于Gaven Xu瞎胡闹产品，没有数据库，没有账号，没有表情包，没有好友记录，没有群组，不会记录任何信息，请放心使用，萍水相逢，能在一起聊天即是缘分，如有问题，请输入help命令查看帮助。',\n                    color: '#d04778'\n                }, isRemote)\n            })\n\n        } else {\n            set.nick.placeholder = 'Try 5-20 letter';\n            set.nick.value = '';\n            set.nick.focus();\n        }\n    })\n\n    function messageHandle() {\n        var data = wsHandle.filterData(input.from, input.to, input.message)\n\n        //command\n        if (data.hasOwnProperty('command')) {\n\n            if (data.command == '@' && data.m.trim().length > 0) {\n                wsHandle.sendMessage(data, function (data) {\n                    wsHandle.showMessage(Box, data, !isRemote)\n                    wsHandle.clearInput([input.message], input.message);\n                });\n            }\n\n            if (data.command == '>') {\n                wsHandle.searchBaiduImage(data.m, function (imgArray) {\n                    var domSet = wsHandle.formatImageSet(imgArray);\n                    data.m = imgArray;\n                    wsHandle.sendLocalSearch(data, function (_data) {\n                        _data.m = domSet;\n                        console.log(_data);\n                        wsHandle.showSearchResult(Box, _data);\n                        wsHandle.clearInput([input.message], input.message);\n                    })\n                });\n            }\n\n            if (data.command == 'help') {\n                wsHandle.showMessage(Box, data, isRemote)\n                wsHandle.clearInput([input.message], input.message);\n            }\n\n            if (data.command == 'clear') {\n                Box.innerHTML = '';\n                wsHandle.clearInput([input.message], input.message);\n            }\n\n            if (data.command == 'quit') {\n                socket.close();\n                window.close();\n            }\n\n        } else {\n\n            if (data.m.trim().length > 0) {\n                wsHandle.sendMessage(data, function (data) {\n                    wsHandle.showMessage(Box, data, !isRemote)\n                    wsHandle.clearInput([input.message], input.message);\n                });\n            }\n\n        }\n    }\n\n    input.addEventListener('submit', function (e) {\n\n        e.preventDefault();\n\n        messageHandle();\n\n    })\n\n    message.addEventListener('keydown', function (e) {\n\n        if (e.keyCode == \"16\" && !shiftDown) { // only Shift\n            shiftDown = true;\n        }\n\n        if (e.keyCode == \"13\" && !shiftDown) { // only Enter\n\n            e.preventDefault();\n\n            messageHandle();\n\n        }\n\n        if (e.keyCode == \"13\" && shiftDown) { //Shift + Enter\n            e.preventDefault();\n            input.message.value += '\\n';\n            input.message.scrollTop = input.message.scrollHeight;\n        }\n\n    })\n\n    message.addEventListener('keyup', function (e) {\n\n        if (e.keyCode == \"16\") { // Shift\n\n            shiftDown = false;\n\n        }\n\n    })\n\n    function formatTime(date, str) {\n        if (typeof str == \"string\") {\n            return date.getHours() + str + date.getMinutes() + str + date.getSeconds();\n        } else {\n            console.log('the second argument should be string');\n        }\n    }\n\n    /**\n     * 如果已经成功跟某个人私信过，input.to的selected应该为这个人的名字\n     *\n     * 如果按@符号，则开始监听输入，每次keyup，取@后面的字符串，input.to的selected应该为这个人的名字。如果按space，则停止监听，\n     */\n\n})()\n"]}