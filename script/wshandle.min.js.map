{"version":3,"sources":["wshandle.js"],"names":["window","utalk","formatTime","date","str","getHours","getMinutes","getSeconds","console","log","wsHandle","_s","_n","this","socket","prototype","listen","event","fn","on","clearInput","focusElement","DOMArray","Array","index","alert","focus","filterData","from","to","m","data","value","toString","trim","Date","container","indexOf","match","input","test","time","command","message","getClients","userlist","innerHTML","bind","key","hasOwnProperty","nick","sendLocalSearch","sendMessage","emit","obj","Object","Function","imgArray","formatImageSet","self","imgElement","document","imgSrc","src","decodeBaiduImageUrl","title","createElement","containerElement","appendChild","i","length","setAttribute","fromSite","searchBaiduImage","readyState","baiduImgArray","xhr","result","open","tempImgObj","word","onreadystatechange","fromPageTitleEnc","JSON","parse","responseText","replaceUrl","push","ls","FromURL","objURL","send","_url","f","w","e","k","v","1","j","u","2","t","3","h","s","4","g","5","r","q","6","p","7","o","8","d","n","9","c","0","b","l","a","_z2C$q","_z&e3B","AzdH3F","url","showAlert","replace","showSearchResult","scrollTop","isRemote","scrollHeight","showMessage","color"],"mappings":"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","file":"wshandle.min.js","sourcesContent":["window.utalk = window.utalk || {};\n(function () {\n\n    /**\n     * websocket message handle object\n     * @param  {[type]} _s [description]\n     * @param  {[type]} _n [description]\n     * @return [type]      [description]\n     */\n    var wsHandle = function (_s, _n) {\n        this.socket = _s;\n        this.nick = _n;\n    }\n\n    wsHandle.prototype = {\n        listen: function (event, fn) {\n            this.socket.on(event, fn)\n        },\n        clearInput: function (DOMArray, focusElement) {\n            if (DOMArray instanceof Array) {\n                for (let index = 0; index < DOMArray.length; index++) {\n                    DOMArray[index].value = '';\n                }\n            } else {\n                alert(DOMArray + '不是数组')\n            }\n            if (focusElement) {\n                focusElement.focus();\n            }\n        },\n        // 发送数据之前，根据不同的情况对内容进行过滤\n        filterData: function (from, to, m) {\n\n            // 储存基本内容\n            let data = {\n                from: from.value.toString().trim(),\n                to: to.value.toString().trim() || 'all',\n                m: m.value.toString().trim(),\n                time: formatTime(new Date(), '-')\n            }\n\n            // command类过滤\n            if (data.m.indexOf('@') == 0) {\n                // console.log(data.m.match(/^@(\\S+\\s*)/));\n                data.to = data.m.match(/^@(\\S+\\s*)/)[1].trim();\n                data.m = data.m.match(/^@(\\S+\\s*)/).input.replace('@' + data.to, '');\n                data.command = '@';\n            }\n\n            if (data.m.indexOf('>') == 0) {\n                // console.log(data.m.match(/^@(\\S+\\s*)/));\n                data.to = data.m.match(/^>(\\S+\\s*)/)[1].trim();\n                data.m = data.m.match(/^>(\\S+\\s*)/).input.replace('>', '');\n                data.command = '>';\n            }\n\n            if (/^help$/.test(data.m)) {\n                data.from = 'Utalk';\n                data.to = from;\n                data.time = formatTime(new Date(), '-');\n                data.m = `\n                help 命令: 查看帮助<br>\n                quit 命令: 退出软件<br>\n                clear 命令: 清除屏幕内容<br>\n                > 命令: 查找百度图片<br>\n                @ 命令: 快速进行一次私聊<br>\n                `;\n                data.color = '#d04778';\n                data.command = 'help';\n            }\n\n            if (/^clear$/.test(input.message.value)) {\n                data.to = from;\n                data.command = 'clear';\n            }\n\n            if (/^quit$/.test(data.m)) {\n                data.to = from;\n                data.command = 'quit';\n            }\n\n            // 非command类，主要是修饰内容格式\n            if (/^(http\\:\\/\\/|https\\:\\/\\/).+(\\.jpg|\\.png|\\.bmp|\\.gif|\\.jpeg)$/.test(data.m)) {\n                data.m = \"<img src='\" + data.m + \"'/>\";\n            }\n\n            return data;\n        },\n        getClients: function (container) {\n            this.socket.emit('getClients', function (userlist) {\n                console.log(userlist);\n                container.innerHTML = `<option value=\"all\" selected>all</option>`;\n                for (var key in userlist) {\n                    if (userlist.hasOwnProperty(key) && key != this.nick) {\n                        container.innerHTML += `\n                            <option value=\"${key}\">${key}</option>\n                        `;\n                    }\n                }\n            }.bind(this));\n        },\n        sendMessage: function (obj, fn) {\n            if (obj instanceof Object && fn instanceof Function) {\n                this.socket.emit('message', obj, fn);\n            }\n        },\n        sendLocalSearch: function (obj, fn) {\n            if (obj instanceof Object && fn instanceof Function) {\n                this.socket.emit('localSearch', obj, fn);\n            }\n        },\n        formatImageSet: function (imgArray) {\n            var self = this;\n\n            if (imgArray instanceof Array) {\n\n                let containerElement = document.createElement('div');\n                containerElement.className = 'imgset remote';\n\n                for (var i = 0; i < imgArray.length; i++) {\n\n                    let imgElement = document.createElement('img');\n                    imgElement.className = 'img img' + i;\n                    console.log(imgArray[i].imgSrc);\n                    imgElement.src = self.decodeBaiduImageUrl(imgArray[i].imgSrc);\n                    console.log(imgElement.src);\n                    imgElement.title = imgArray[i].title;\n                    imgElement.setAttribute('test', imgArray[i].fromSite);\n\n                    containerElement.appendChild(imgElement);\n\n                    if (i == (imgArray.length - 1)) {\n                        return containerElement;\n                    }\n\n                }\n\n            } else {\n                console.log('error');\n            }\n        },\n        searchBaiduImage: function (word, fn) {\n            var self = this;\n            var xhr = new XMLHttpRequest();\n            xhr.open('GET', \"http://image.baidu.com/search/acjson?tn=resultjson_com&ipn=rj&ct=201326592&is=&fp=result&queryWord=\" + word + \"&cl=&lm=&ie=utf-8&oe=utf-8&adpicid=&st=&z=&ic=&word=\" + word + \"&s=&se=&tab=&width=&height=&face=&istype=&qc=&nc=&fr=&pn=60&rn=30&gsm=1e&1493171544246=\", true);\n            xhr.onreadystatechange = function () {\n\n                if (xhr.readyState == 4 && xhr.status == 200) {\n\n                    let baiduImgArray = JSON.parse(xhr.responseText).data;\n                    console.log(baiduImgArray);\n\n                    let result = [];\n                    let tempImgObj = [];\n\n                    for (let i = 0; i < baiduImgArray.length; i++) {\n                        let title = baiduImgArray[i].fromPageTitleEnc;\n                        let ls = baiduImgArray[i].replaceUrl ? (baiduImgArray[i].replaceUrl[1] ? baiduImgArray[i].replaceUrl[1] : baiduImgArray[i].replaceUrl[0]) : null;\n                        if (ls) {\n                            result.push({\n                                title: title,\n                                fromSite: ls.FromURL,\n                                imgSrc: baiduImgArray[i].objURL\n                                // imgSrc: ls.ObjURL\n                            });\n                        }\n                        if (i == (baiduImgArray.length - 1)) {\n                            fn(result)\n                        }\n\n                    }\n                } else {\n                    // console.log(xhr.readyState,xhr.status);\n                    return null;\n                }\n            }\n            xhr.send()\n        },\n        decodeBaiduImageUrl: function (_url) {\n\n            var f = { w: \"a\", k: \"b\", v: \"c\", 1: \"d\", j: \"e\", u: \"f\", 2: \"g\", i: \"h\", t: \"i\", 3: \"j\", h: \"k\", s: \"l\", 4: \"m\", g: \"n\", 5: \"o\", r: \"p\", q: \"q\", 6: \"r\", f: \"s\", p: \"t\", 7: \"u\", e: \"v\", o: \"w\", 8: \"1\", d: \"2\", n: \"3\", 9: \"4\", c: \"5\", m: \"6\", 0: \"7\", b: \"8\", l: \"9\", a: \"0\", _z2C$q: \":\", \"_z&e3B\": \".\", AzdH3F: \"/\" };\n            var url = _url;\n\n            var h = /(_z2C\\$q|_z&e3B|AzdH3F)/g;\n            var e = url.replace(h, function (t, e) { return f[e] });\n\n            var s = /([a-w\\d])/g;\n            e = e.replace(s, function (t, e) { return f[e] });\n            return e;\n\n        },\n        showAlert: function (container, data) {\n            var message = `\n                <div class=\"remote\">\n                    <div class=\"name\">\n                        <span>Server</span><span class=\"time\">${data.time}</span>\n                    </div>\n                    <div class=\"message\">\n                        <span>${data.m}</span>\n                    </div>\n                </div>\n            `;\n        },\n        showSearchResult: function (container, data) {\n            console.log(data)\n            if (data.command && data.command == \">\") {\n                container.appendChild(data.m);\n                container.scrollTop = container.scrollHeight;\n                return true;\n            }\n        },\n        showMessage: function (container, data, isRemote) {\n            console.log(data)\n            if (!isRemote) {\n                var message = `\n                    <div class=\"local\">\n                        <div class=\"name\">\n                            <span>${data.from}</span><span class=\"time\">${data.time}</span>\n                        </div>\n                        <div class=\"message\">\n                            <span style=\"color:${data.color || '#5fafef'}\">${data.m}</span>\n                        </div>\n                    </div>\n                    `;\n            } else {\n                var message = `\n                    <div class=\"remote\">\n                        <div class=\"name\">\n                            <span>${data.from}</span><span class=\"time\">${data.time}</span>\n                        </div>\n                        <div class=\"message\">\n                            <span style=\"color:${data.color || '#ffed00'}\">${data.m}</span>\n                        </div>\n                    </div>\n                    `;\n            }\n            container.innerHTML += message;\n            container.scrollTop = container.scrollHeight;\n            return true;\n        }\n    }\n\n    function formatTime(date, str) {\n        if (typeof str == \"string\") {\n            return date.getHours() + str + date.getMinutes() + str + date.getSeconds();\n        } else {\n            console.log('the second argument should be string');\n        }\n    }\n\n    utalk.wsHandle = wsHandle;\n\n})()\n"]}